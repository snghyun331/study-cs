**ë””ìì¸ íŒ¨í„´ì´ë€?**

í”„ë¡œê·¸ë¨ì„ ì„¤ê³„í•  ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œì ë“¤ì„ (ê°ì²´ ê°„ì˜ ìƒí˜¸ê´€ê³„ ë“±ì„ ì´ìš©í•˜ì—¬) í•´ê²°í•  ìˆ˜ ìˆë„ë¡ í•˜ë‚˜ì˜ â€˜ê·œì•½â€™ í˜•íƒœë¡œ ë§Œë“¤ì–´ ë†“ì€ ê²ƒ

# ì‹±ê¸€í†¤ íŒ¨í„´

- í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì— ì˜¤ì§ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ ê°€ì§€ëŠ” íŒ¨í„´ (í•˜ë‚˜ì˜ ìœ ì¼í•œ ê°ì²´ë§Œ ìƒì„±í•˜ëŠ” ëª©ì )
- í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë†“ê³  í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‹¤ë¥¸ ëª¨ë“ˆë“¤ì´ ê³µìœ í•˜ë©° ì‚¬ìš©. ì¦‰, ë˜‘ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ **ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê³  ê¸°ì¡´ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì™€** í™œìš©í•˜ëŠ” ê¸°ë²•

> â€œìš°ë¦¬ê°€ **ì „ì—­**ë³€ìˆ˜ ë¼ëŠ” ê±¸ ë§Œë“¤ì–´ ì´ìš©í•˜ëŠ” ì´ìœ ëŠ”, ë˜‘ê°™ì€ ë°ì´í„°ë¥¼ ë©”ì„œë“œë§ˆë‹¤ ì§€ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•´ì„œ ì‚¬ìš©í•˜ë©´ ë‚­ë¹„ì´ê¸° ë•Œë¬¸ì—, ì „ì—­ì—ì„œ í•œë²ˆí•œ ë°ì´í„°ë¥¼ ì„ ì–¸í•˜ê³  ê°€ì ¸ì™€ ì‚¬ìš©í•˜ë©´ íš¨ìœ¨ì ì´ë‹¤.â€
> 

ì´ëŸ¬í•œ ê°œë…ì„ ê·¸ëŒ€ë¡œ í´ë˜ìŠ¤ì— ëŒ€ì…í•œ ê²ƒì´ ì‹±ê¸€í†¤ íŒ¨í„´ì´ë‹¤.

ë³´í†µ ì‹±ê¸€í†¤ íŒ¨í„´ì´ ì ìš©ëœ ê°ì²´ê°€ í•„ìš”í•œ ê²½ìš°ëŠ” ê·¸ ê°ì²´ê°€ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì°¨ì§€í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ë¬´ê±°ìš´ í´ë˜ìŠ¤ì¼ ë•Œ ì í•©í•˜ë‹¤.

â€» staticì„ ì‚¬ìš©í•˜ë©´ ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ìˆì„ ìˆ˜ ìˆìŒ

## ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ì‹±ê¸€í†¤

1. **Module Pattern**
    
    ```jsx
    interface IPerson {
      name: string;
      age: number;
      greeting: VoidFunction;
    }
    
    const Person = (function () {
      let instance: IPerson | undefined;  // private ë³€ìˆ˜
    
      function createInstance(): IPerson {
        return {
          name: 'jacob',
          age: 30,
          greeting: function () {
            return `Hi! ${this.name}`;
          },
        };
      }
      return {
        getInstance: function () {
          if (instance === undefined) {
            instance = createInstance();
          }
          return instance;
        },
      };
    })();
    ```
    
    - `Person`ì€ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜(IIFE)ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“ˆ íŒ¨í„´ì„ êµ¬í˜„í•œ ê²ƒ
    - `instance` ë³€ìˆ˜ëŠ” ì½”ë“œ ë‚´ë¶€ì— privateí•˜ê²Œ ì •ì˜ë˜ì–´ìˆê³ , ì¸ìŠ¤í„´ìŠ¤ê°€ í•œë²ˆë§Œ ìƒì„±ë˜ê³  ë‚˜ë©´ ì´ ë³€ìˆ˜ì— ì €ì¥ëœë‹¤.
    - `createInstance` í•¨ìˆ˜ëŠ” privateí•˜ë©°, ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ì£¼ì²´ì´ë‹¤. í´ë˜ìŠ¤ì˜ ìƒì„±ì ì—­í• ì„ í•˜ë©° ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•œë‹¤.
    - `getInstance` í•¨ìˆ˜ëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ í•µì‹¬. ì´ë¯¸ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ë‹¤ë©´ createInstanceë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±
        - ì´ë¯¸ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ë°˜í™˜í•˜ê³ , ì—†ìœ¼ë©´ ìƒì„±í•˜ì—¬ ë°˜í™˜í•œë‹¤.
        - ì´ë ‡ê²Œ í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
           
    ```jsx
    // Usage
    const jacob1 = Person.getInstance();
    const jacob2 = Person.getInstance();
    
    console.log(jacob1 === jacob2); // true
    ```
    
    - `Person.getInstance()`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì–»ëŠ”ë‹¤. ì´ ë•Œ, **ì²˜ìŒ í˜¸ì¶œí•  ë•Œë§Œ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ê·¸ ì´í›„ì—ëŠ” ê¸°ì¡´ì— ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜**
    - `jacob1`ê³¼ `jacob2`ëŠ” ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ë¯€ë¡œ `true`ê°€ ì¶œë ¥ëœë‹¤.
    

    > ì¢…í•©í•˜ë©´, ì½”ë“œëŠ” ë‹¨ì¼í•œ ê°ì²´ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ íŒ¨í„´ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ì´ ê°ì²´ëŠ” **`IPerson`** ì¸í„°í˜ì´ìŠ¤ë¥¼ ë”°ë¥´ë©°, **í•œ ë²ˆ ìƒì„±ë˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ ë˜ê³  ì¬ì‚¬ìš©ëœë‹¤**. ë”°ë¼ì„œ ì£¼ì–´ì§„ ì½”ë“œëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ¬í˜„í•˜ê³  ìˆë‹¤.
    > 

1. **ES6 Class**
    
    DB Connectionì²˜ëŸ¼ í•œ ì‹œìŠ¤í…œì—ì„œ ë§¤ë²ˆ Connectionì„ ì—°ê²°í•  í•„ìš”ê°€ ì—†ì„ ë•Œ 
    
    ```jsx
    const URL = 'mongodb://localhost:27017/kundolapp';
    const URL2 = 'mongodb://localhost:27017/kundolapp222';
    
    const createConnection = (url) => ({ url: url });
    
    class DB {
    	constructor(url) {
    		if (!DB.instance) {
    			DB.instance = createConnection(url);
    		}
    		return DB.instance;
    	}
    	connect() {
    		return this.instance;
    	}
    }
    ```
    
    - ìƒì„±ìì—ì„œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ë‹¤ë©´ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•œë‹¤. ì´ë¡œì¨ `a`ì™€ `b`ê°€ `DB` í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë”ë¼ë„ í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.
    - `DB.instance`: í´ë˜ìŠ¤ì˜ ì •ì  ë©¤ë²„ë¡œì„œ, ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•˜ëŠ” í”„ë¡œí¼í‹°.
    - `constructor(url)`: ìƒì„±ìì—ì„œëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ì´ë¯¸ ìˆëŠ” ê²½ìš°ì—ëŠ” ê¸°ì¡´ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.
    - `connect()`: ë‹¨ìˆœíˆ í˜„ì¬ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ.
    
    ```jsx
    // Usage
    const a = new DB(URL);
    const b = new DB(URL2);
    console.log(a);  // { url: 'mongodb://localhost:27017/kundolapp' }
    console.log(b);  // { url: 'mongodb://localhost:27017/kundolapp' }
    console.log(a === b); // true
    ```
    
    ì‹±ê¸€í†¤ íŒ¨í„´ì˜ íŠ¹ì§•ì— ë”°ë¼ aì™€ bëŠ” ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ê°™ì€ ê²°ê³¼ë¥¼ ì¶œë ¥í•œë‹¤.
    
2. **Object Literal**

    ```jsx
    const createDB = (url) => {
      let instance;
    
      const connect = () => instance;
    
      return {
        getInstance: () => {
          if (!instance) {
            instance = { url: url };
          }
          return instance;
        },
        connect: connect,
      };
    };
    
    // ì˜ˆì œì—ì„œ DB ê°ì²´ ìƒì„±
    const dbA = createDB('mongodb://localhost:27017/kundolapp');
    const dbB = createDB('mongodb://localhost:27017/kundolapp222');
    
    console.log(dbA.getInstance()); // { url: 'mongodb://localhost:27017/kundolapp' }
    console.log(dbB.getInstance()); // { url: 'mongodb://localhost:27017/kundolapp' }
    
    console.log(dbA.getInstance() === dbB.getInstance()); // true 
    ```
## NestJsì˜ ì‹±ê¸€í†¤

âœ… ì‹±ê¸€í†¤ì€ íŒ¨í„´ì€ ëª¨ë“ˆ ê°„ì˜ ê²°í•©ì„ ê°•í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.

âœ… NestJsì—ì„œëŠ” ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `@Injectable`ì„ ì´ìš©í•œ **ì˜ì¡´ì„± ì£¼ì…(DI)**ì„ í†µí•´ ëª¨ë“ˆ ê°„ì˜ ê²°í•©ì„ ì¡°ê¸ˆ ë” ëŠìŠ¨í•˜ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.

- **ì˜ì¡´ì„± ì£¼ì…(DI)**
    
    ![Untitled](https://github.com/snghyun331/study-cs/assets/108854903/23de4259-b964-4254-bb3f-921ccf4c8311)
    
    **â€œAê°€ Bì— ì˜ì¡´ì„±ì´ ìˆë‹¤â€** â†’ Bì˜ ë³€ê²½ì‚¬í•­ì— ëŒ€í•´ A ë˜í•œ ë³€í•´ì•¼í•œë‹¤.
    
    ìœ„ ê·¸ë¦¼ì²˜ëŸ¼ ë©”ì¸ ëª¨ë“ˆì´ â€˜ì§ì ‘â€™ ë‹¤ë¥¸ í•˜ìœ„ ëª¨ë“ˆì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì£¼ê¸°ë³´ë‹¤ëŠ”, ì¤‘ê°„ì— ì˜ì¡´ì„± ì£¼ì…ìê°€ ì´ ë¶€ë¶„ì„ ê°€ë¡œì±„ ë©”ì¸ ëª¨ë“ˆì´ â€˜**ê°„ì ‘â€™**ì ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…í•˜ëŠ” ë°©ì‹
    
    ì´ë¥¼ í†µí•´ ë©”ì¸ëª¨ë“ˆ(ìƒìœ„ ëª¨ë“ˆ)ì€ í•˜ìœ„ ëª¨ë“ˆì— ëŒ€í•œ ì˜ì¡´ì„±ì´ ë–¨ì–´ì§€ê²Œ ë¨
    

âœ… í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ global í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ë„ ì§‘ì•½ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. global í•˜ê²Œ ì‚¬ìš©í•œë‹¤ë©´ Aí´ë˜ìŠ¤ì—ì„œ Bí´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼ì„ ë°©ì§€ í•˜ê¸° ìœ„í•´ private ì„ ì„ ì–¸í•´ì£¼ëŠ” ë°©ë²•ë„ ìˆë‹¤.

ì‹±ê¸€í†¤ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” `@Injectable(), @Module()` ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•œë‹¤. í•´ë‹¹ ë°ì½”ë ˆì´í„°ë¥¼ ì„ ì–¸í•˜ë©´, í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ nest ë‚´ì¥ IOC container ê°€ ê´€ë¦¬í•œë‹¤

(ë°ì½”ë ˆì´í„°ê°€ ë‹¬ë¦° í´ë˜ìŠ¤ëŠ” íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì»´íŒŒì¼ì‹œ ë©”íƒ€ë°ì´í„°ë¡œ ì–´ë–¤ ì„œë¹„ìŠ¤ì— ì˜ì¡´í•˜ê³  ìˆëŠ”ì§€ ëª…ì‹œë¥¼ í•´ì¤€ë‹¤. ê·¸ëŸ¬ë©´ nestjs ê°€ ì–´ë–¤ ì˜ì¡´ê´€ê³„ê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.)

ğŸ‘‰ **nest ë‚´ë¶€ì˜ IOC container ê°€ @Injectable(), @Module() ë°ì½”ë ˆì´í„° í´ë˜ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ìƒì„±í•˜ì—¬ DIì˜ ëŒ€ìƒìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.**

```jsx
@Injectable()
export class PostsService {
  constructor(
    @Inject(Logger) private readonly logger: LoggerService,
    private postsRepository: PostsRepository,
    private dataSource: DataSource,
  ) {}

  async createPost(createUserDto, userId) {
    const queryRunner = this.dataSource.createQueryRunner();
    ....
}
```

- ìœ„ ì½”ë“œëŠ” NestJSì—ì„œ ì‚¬ìš©ë˜ëŠ” ì„œë¹„ìŠ¤(**`PostsService`**)ë¡œ, ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•œë‹¤. NestJSì—ì„œ **`@Injectable()`** ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ì„œë¹„ìŠ¤ê°€ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ë„ë¡ ëœë‹¤. ë”°ë¼ì„œ **`PostsService`** í´ë˜ìŠ¤ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œì„ ê°–ê²Œ ëœë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´ PostServiceê°€ imports, providers ë‘ êµ°ë°ë¡œ ì£¼ì…ë˜ì–´ë„ ì‹±ê¸€í†¤ìœ¼ë¡œ ìƒì„±ì´ ëœë‹¤.

> ì¢…í•©í•´ë³´ë©´, NestJSì—ì„œ ì˜ì¡´ì„± ì£¼ì…ì€ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìë™ìœ¼ë¡œ ì ìš©í•´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ê°œë°œìê°€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì§ì ‘ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼Â **ëª¨ë“ˆì„ ì£¼ì…í•˜ëŠ” ê³¼ì •ì„ í†µí•´ nestjsê°€ ì•Œì•„ì„œ ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ë‹¤.**
>

---

## References

[Inpa Dev](https://inpa.tistory.com/entry/GOF-ğŸ’ -ì‹±ê¸€í†¤Singleton-íŒ¨í„´-ê¼¼ê¼¼í•˜ê²Œ-ì•Œì•„ë³´ì)

https://ajdkfl6445.gitbook.io/study/typescript/singleton-pattern

[https://velog.io/@pptrolldev/Javascript-ES6-ìƒì„±-íŒ¨í„´](https://velog.io/@pptrolldev/Javascript-ES6-%EC%83%9D%EC%84%B1-%ED%8C%A8%ED%84%B4)

https://velog.io/@leejm_dev/nestjs-singleton
